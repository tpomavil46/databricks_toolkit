{
  "name": "DLT-Pipeline-Retail-Analytics",
  "description": "Delta Live Tables pipeline for retail analytics with streaming capabilities",
  "email_notifications": {
    "on_start": [
      "admin@company.com"
    ],
    "on_success": [
      "admin@company.com"
    ],
    "on_failure": [
      "admin@company.com",
      "data-team@company.com"
    ]
  },
  "max_concurrent_runs": 1,
  "tasks": [
    {
      "task_key": "setup_environment",
      "description": "Setup environment and create test data",
      "notebook_task": {
        "notebook_path": "/Repos/databricks_toolkit/workflows/sql_driven/jobs/setup_environment",
        "base_parameters": {
          "environment": "prod",
          "project": "retail"
        }
      },
      "job_cluster_key": "dlt-cluster",
      "timeout_seconds": 600
    },
    {
      "task_key": "bronze_ingestion",
      "description": "Bronze layer data ingestion with Auto Loader",
      "notebook_task": {
        "notebook_path": "/Repos/databricks_toolkit/workflows/sql_driven/jobs/bronze_ingestion",
        "base_parameters": {
          "source_path": "/tmp/streaming_source",
          "table_name": "retail_bronze",
          "file_format": "json"
        }
      },
      "job_cluster_key": "dlt-cluster",
      "depends_on": [
        {
          "task_key": "setup_environment"
        }
      ],
      "timeout_seconds": 1200
    },
    {
      "task_key": "silver_transformation",
      "description": "Silver layer data transformation with quality checks",
      "notebook_task": {
        "notebook_path": "/Repos/databricks_toolkit/workflows/sql_driven/jobs/silver_transformation",
        "base_parameters": {
          "bronze_table": "retail_bronze",
          "silver_table": "retail_silver"
        }
      },
      "job_cluster_key": "dlt-cluster",
      "depends_on": [
        {
          "task_key": "bronze_ingestion"
        }
      ],
      "timeout_seconds": 1200
    },
    {
      "task_key": "gold_aggregation",
      "description": "Gold layer analytics and aggregations",
      "notebook_task": {
        "notebook_path": "/Repos/databricks_toolkit/workflows/sql_driven/jobs/gold_aggregation",
        "base_parameters": {
          "silver_table": "retail_silver",
          "gold_table": "retail_analytics"
        }
      },
      "job_cluster_key": "dlt-cluster",
      "depends_on": [
        {
          "task_key": "silver_transformation"
        }
      ],
      "timeout_seconds": 1200
    },
    {
      "task_key": "create_dashboard",
      "description": "Create and update analytics dashboard",
      "notebook_task": {
        "notebook_path": "/Repos/databricks_toolkit/workflows/sql_driven/jobs/create_dashboard",
        "base_parameters": {
          "gold_table": "retail_analytics",
          "dashboard_name": "Retail Analytics Dashboard"
        }
      },
      "job_cluster_key": "dlt-cluster",
      "depends_on": [
        {
          "task_key": "gold_aggregation"
        }
      ],
      "timeout_seconds": 600
    }
  ],
  "job_clusters": [
    {
      "job_cluster_key": "dlt-cluster",
      "new_cluster": {
        "spark_version": "13.3.x-scala2.12",
        "node_type_id": "Standard_DS3_v2",
        "num_workers": 2,
        "spark_conf": {
          "spark.databricks.delta.preview.enabled": "true",
          "spark.databricks.delta.liveTable.enabled": "true"
        },
        "aws_attributes": {
          "availability": "SPOT"
        }
      }
    }
  ]
}